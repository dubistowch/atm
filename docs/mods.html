<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨¡çµ„åˆ—è¡¨ - ATMon å°‹æ˜Ÿä¹‹å¤¢</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* Specific overrides for mods.html */
        .category-header {
            background: linear-gradient(90deg, var(--panel-bg), transparent);
            padding: 15px 20px;
            border-radius: 8px;
            margin: 30px 0 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            border-left: 5px solid var(--accent-primary);
            border-top: 1px solid var(--border-color);
            border-bottom: 1px solid var(--border-color);
        }
        .category-title { font-size: 20px; font-weight: bold; color: #fff; margin: 0; }
        .category-count { color: var(--text-dim); font-size: 14px; }
        
        .mod-row {
            grid-template-columns: 50px 250px 1fr 180px;
        }
        
        #extra-mods-btn {
            width: 100%;
            margin: 40px 0;
            padding: 20px;
            font-size: 18px;
        }
        
        .mod-name-zh { font-size: 16px; font-weight: bold; color: var(--accent-primary); margin: 0; text-decoration: none; }
        .mod-name-en { font-size: 11px; color: var(--text-dim); margin-top: 2px; font-family: ui-monospace, SFMono-Regular, monospace; display: block; }
        
        .mod-meta-info { display: flex; flex-direction: column; align-items: flex-end; gap: 5px; font-size: 12px; color: var(--text-dim); text-align: right; }
        .mod-version { color: var(--text-main); background: var(--card-bg); padding: 2px 8px; border-radius: 4px; border: 1px solid var(--border-color); }
        .mod-author { color: var(--accent-secondary); }

        /* Mobile optimization for mod rows */
        @media (max-width: 700px) {
            .mod-row {
                grid-template-columns: 40px 1fr;
                grid-template-rows: auto auto auto;
                gap: 10px;
                padding: 12px 14px;
            }
            .mod-row img { width: 34px; height: 34px; }
            .mod-desc { grid-column: 1 / -1; font-size: 13px; }
            .mod-meta-info {
                grid-column: 1 / -1;
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
                text-align: left;
                gap: 10px;
            }
        }

        @media (max-width: 420px) {
            .mod-row { grid-template-columns: 34px 1fr; padding: 10px 12px; }
            .mod-name-zh { font-size: 15px; }
            .mod-name-en { font-size: 10px; }
            .mod-desc { font-size: 12px; }
        }
    </style>
</head>
<body>

<nav class="navbar">
    <div class="nav-container">
        <a href="index.html" class="nav-brand">å°‹æ˜Ÿä¹‹å¤¢ <span>ATMon</span></a>
        <button class="nav-toggle" type="button" aria-label="é–‹å•Ÿé¸å–®" aria-expanded="false" onclick="toggleNavMenu()">â˜°</button>
        <div class="nav-links" id="nav-links">
            <a href="index.html" class="nav-item">ğŸ“– å†’éšªæŒ‡å—</a>
            <a href="controls.html" class="nav-item">âŒ¨ï¸ æŒ‰éµå°ç…§</a>
            <a href="mods.html" class="nav-item active">ğŸ“¦ æ¨¡çµ„ç™¾ç§‘</a>
            <a href="errata.html" class="nav-item">ğŸ§¾ å‹˜èª¤ç´€éŒ„</a>
        </div>
    </div>
</nav>

<a class="report-btn" id="report-btn" href="https://n8n.dubi.app/form/6e15be41-ae88-4e0d-9241-09d3d418e2f8" target="_blank" rel="noopener noreferrer" title="å›å ±éŒ¯èª¤">ğŸ› å›å ±éŒ¯èª¤</a>

<div class="container">
    <div class="page-header">
        <h1 class="page-title">æ¨¡çµ„ç™¾ç§‘</h1>
        <p class="page-subtitle" id="mod-count">æ­£åœ¨è®€å–æ¨¡çµ„è³‡æ–™...</p>
    </div>

    <div class="search-container">
        <input type="text" id="search-input" class="search-input" placeholder="æœå°‹ 380+ å€‹æ¨¡çµ„ä¸­çš„åç¨±ã€ä½œè€…ã€åˆ†é¡æˆ–ä»‹ç´¹...">
    </div>

    <div id="featured-content">
        <!-- Featured Modules -->
    </div>

    <button id="extra-mods-btn" class="btn">ğŸ“¦ é»æ“Šå±•é–‹æ›´å¤šæ¨¡çµ„ (åŒ…å«è¼”åŠ©åº«èˆ‡å…¶é¤˜ 200+ å€‹æ¨¡çµ„)</button>

    <div id="extra-mods-container" class="hidden">
        <div id="extra-content">
            <!-- Other Modules -->
        </div>
    </div>

    <div id="no-results" class="loading hidden">æ‰¾ä¸åˆ°ç¬¦åˆæ¢ä»¶çš„æ¨¡çµ„ã€‚</div>
</div>

<script>
    const defaultIcon = "https://media.forgecdn.net/avatars/53/430/636136190539169641.png";
    
    const categoryConfig = {
        "ç§‘æŠ€": "âš™ï¸ ç§‘æŠ€ç™¼å±• (Technology)",
        "é­”æ³•": "âœ¨ é­”æ³•ç§˜è¡“ (Magic)",
        "å†’éšªèˆ‡æ¢ç´¢": "ğŸŒ å†’éšªèˆ‡æ¢ç´¢ (Adventure)",
        "å„²å­˜èˆ‡èƒŒåŒ…": "ğŸ’ å„²å­˜èˆ‡èƒŒåŒ… (Storage)",
        "ä¸–ç•Œç”Ÿæˆ": "ğŸŒ³ ä¸–ç•Œç”Ÿæˆ (World Gen)",
        "å·¥å…·èˆ‡å¯¦ç”¨": "ğŸ”§ å·¥å…·èˆ‡å¯¦ç”¨ (Utility)",
        "è¾²æ¥­èˆ‡æ–™ç†": "ğŸ³ è¾²æ¥­èˆ‡æ–™ç† (Farming)",
        "å»ºç¯‰èˆ‡è£é£¾": "ğŸ  å»ºç¯‰èˆ‡è£é£¾ (Building)",
        "éŸ³æ•ˆèˆ‡è¦–è¦º": "ğŸ¨ éŸ³æ•ˆèˆ‡è¦–è¦º (Visuals)",
        "ä»‹é¢èˆ‡HUD": "ğŸ“Š ä»‹é¢èˆ‡ HUD (UI)",
        "æ•ˆèƒ½æœ€ä½³åŒ–": "âš¡ æ•ˆèƒ½æœ€ä½³åŒ– (Performance)",
        "ç´…çŸ³èˆ‡ç‰©æµ": "ğŸ”´ ç´…çŸ³èˆ‡ç‰©æµ (Redstone)",
        "ç”Ÿç‰©èˆ‡AI": "ğŸ¾ ç”Ÿç‰©èˆ‡ AI (Mobs)",
        "å…¼å®¹èˆ‡æ•´åˆ": "ğŸ§© å…¼å®¹èˆ‡æ•´åˆ (Compat)",
        "å‰ç½®åº«èˆ‡API": "ğŸ› ï¸ å‰ç½®åº«èˆ‡ API (Libs)",
        "ä¼ºæœå™¨ç®¡ç†": "ğŸ–¥ï¸ ä¼ºæœå™¨ç®¡ç† (Server)",
        "å…¶ä»–": "ğŸ“ å…¶ä»– (Others)"
    };

    function parseCSV(text) {
        const lines = text.split('\n');
        const result = [];
        for (let i = 1; i < lines.length; i++) {
            if (!lines[i].trim()) continue;
            const row = [];
            let current = '';
            let inQuotes = false;
            for (let char of lines[i]) {
                if (char === '"') inQuotes = !inQuotes;
                else if (char === ',' && !inQuotes) {
                    row.push(current.trim());
                    current = '';
                } else current += char;
            }
            row.push(current.trim());
            if (row.length < 9) continue;
            result.push({
                name: row[0], url: row[1], version: row[2], author: row[3],
                file: row[4], zh: row[5], icon: row[6], desc: row[7],
                cat: row[8] || "å…¶ä»–"
            });
        }
        return result;
    }

    async function loadAllMods() {
        try {
            const res = await fetch('mods_enriched_ALL_tc_with_icons.csv');
            const text = await res.text();
            const allMods = parseCSV(text);
            const featured = allMods.filter(m => m.icon && m.cat !== "å‰ç½®åº«èˆ‡API" && m.cat !== "æ•ˆèƒ½æœ€ä½³åŒ–" && m.cat !== "å…¶ä»–");
            const others = allMods.filter(m => !featured.includes(m));
            renderUI(featured, others, allMods);
        } catch (e) {
            console.error(e);
            document.getElementById('mod-count').innerText = "è¼‰å…¥å¤±æ•—ã€‚";
        }
    }

    function renderUI(featured, others, allData) {
        const featuredContent = document.getElementById('featured-content');
        const extraContent = document.getElementById('extra-content');
        const searchInput = document.getElementById('search-input');
        const modCountLabel = document.getElementById('mod-count');

        modCountLabel.innerText = `ç›®å‰å·²è¼‰å…¥ ${allData.length} å€‹ç¹é«”ä¸­æ–‡æ¨¡çµ„è³‡æ–™`;

        function filterAndDisplay() {
            const term = searchInput.value.toLowerCase();
            const filtered = allData.filter(m => 
                m.name.toLowerCase().includes(term) || m.zh.toLowerCase().includes(term) ||
                m.author.toLowerCase().includes(term) || m.cat.toLowerCase().includes(term) ||
                m.desc.toLowerCase().includes(term)
            );

            featuredContent.innerHTML = '';
            extraContent.innerHTML = '';

            const grouped = {};
            Object.keys(categoryConfig).forEach(c => grouped[c] = []);
            filtered.forEach(m => {
                const cat = m.cat in categoryConfig ? m.cat : "å…¶ä»–";
                grouped[cat].push(m);
            });

            Object.keys(categoryConfig).forEach(catName => {
                const modsInCat = grouped[catName];
                if (modsInCat.length === 0) return;
                const featuredInCat = modsInCat.filter(m => featured.includes(m));
                const othersInCat = modsInCat.filter(m => !featured.includes(m));
                if (featuredInCat.length > 0) featuredContent.appendChild(createSection(categoryConfig[catName], featuredInCat));
                if (othersInCat.length > 0) extraContent.appendChild(createSection(categoryConfig[catName], othersInCat));
            });

            document.getElementById('no-results').classList.toggle('hidden', filtered.length !== 0);
        }

        searchInput.addEventListener('input', filterAndDisplay);
        filterAndDisplay();
    }

    function createSection(title, mods) {
        const section = document.createElement('div');
        const rows = mods.map(m => {
            const displayIcon = (m.icon && m.icon.trim() !== "") ? m.icon : defaultIcon;
            return `
                <div class="mod-row">
                    <img src="${displayIcon}" loading="lazy" onerror="this.src='${defaultIcon}';">
                    <div>
                        <a href="${m.url || '#'}" target="_blank" class="mod-name-zh">${m.zh || m.name}</a>
                        <span class="mod-name-en">${m.name}</span>
                    </div>
                    <div class="mod-desc">${m.desc || 'æš«ç„¡è©³ç´°ä»‹ç´¹ã€‚'}</div>
                    <div class="mod-meta-info">
                        <span class="mod-author">By ${m.author || 'æœªçŸ¥'}</span>
                        <span class="mod-version">Ver: ${m.version || 'æœ€æ–°'}</span>
                    </div>
                </div>
            `;
        }).join('');
        
        section.innerHTML = `
            <div class="category-header">
                <h2 class="category-title">${title}</h2>
                <span class="category-count">${mods.length} å€‹æ¨¡çµ„</span>
            </div>
            <div class="mod-grid">${rows}</div>
        `;
        return section;
    }

    document.getElementById('extra-mods-btn').addEventListener('click', function() {
        const container = document.getElementById('extra-mods-container');
        const isVisible = container.classList.toggle('hidden');
        this.innerText = !isVisible ? 'ğŸ”¼ éš±è—é¡å¤–æ¨¡çµ„' : 'ğŸ“¦ é»æ“Šå±•é–‹æ›´å¤šæ¨¡çµ„ (åŒ…å«è¼”åŠ©åº«èˆ‡å…¶é¤˜ 200+ å€‹æ¨¡çµ„)';
    });

    function toggleNavMenu() {
        const links = document.getElementById('nav-links');
        const btn = document.querySelector('.nav-toggle');
        if (!links || !btn) return;
        const open = links.classList.toggle('open');
        btn.setAttribute('aria-expanded', open ? 'true' : 'false');
    }

    function updateReportBtn() {
        const a = document.getElementById('report-btn');
        if (!a) return;
        const base = 'https://n8n.dubi.app/form/6e15be41-ae88-4e0d-9241-09d3d418e2f8';
        const u = new URL(base);
        u.searchParams.set('url', window.location.href);
        a.href = u.toString();
    }

    loadAllMods();
    updateReportBtn();
</script>
</body>
</html>
